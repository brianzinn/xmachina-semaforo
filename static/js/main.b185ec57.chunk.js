(this["webpackJsonpxmachina-semaforo"]=this["webpackJsonpxmachina-semaforo"]||[]).push([[0],{435:function(e,t,n){},481:function(e,t,n){},494:function(e,t,n){"use strict";n.r(t);var a,r,i,o,s=n(27),c=n.n(s),l=n(476),u=n.n(l),d=(n(481),n(433)),h=n(103),m=(n(435),n(160)),b=n.n(m),j=n(269),f=n(235),p=n(22),g=n(156),x=(n(450),n(485),n(6)),O=n(0);!function(e){e.Green="Green",e.Amber="Amber",e.Red="Red"}(a||(a={})),function(e){e.TurnGreen="TurnGreen",e.TurnAmber="TurnAmber",e.TurnRed="TurnRed"}(r||(r={})),function(e){e.Walk="Walk",e.Wait="Wait",e.Stop="Stop"}(i||(i={})),function(e){e.AllowWalking="AllowWalking",e.ToWaiting="ToWaiting",e.ToStop="ToStop"}(o||(o={}));var v,w=new Map([[a.Red,"#cc3232"],[a.Amber,"#e7b416"],[a.Green,"#2dc937"]]),T=n(33),k=function(e){console.log(e)};!function(e){e[e.None=0]="None",e[e.Walk=1]="Walk",e[e.Wait=2]="Wait"}(v||(v={}));var S=function(e){var t,n,r,i,o,s=Object(g.e)();e.showDebug&&s.debugLayer.show();var c=Object(g.f)("models/semaforo/","semaforo.obj",void 0,{reportProgress:!0,scaleToDimension:2,onModelLoaded:k,receiveShadows:!0});return Object(T.jsxs)(T.Fragment,{children:[Object(T.jsxs)("abstractMesh",{name:"red",fromInstance:null===(t=c.meshes)||void 0===t?void 0:t.find((function(e){return"mesh_mm2"===e.name})),children:[Object(T.jsx)("standardMaterial",{name:"red-mat",assignFrom:"material",disableLighting:e.trafficLightState.current===a.Red}),e.trafficLightState.current===a.Red&&Object(T.jsx)("spotLight",{name:"red-light",direction:new O.e(0,0,Math.PI),intensity:8,angle:102,exponent:5,diffuse:x.a.Red(),specular:x.a.Red(),position:new O.e(0,5,0)})]}),Object(T.jsxs)("abstractMesh",{name:"amber",fromInstance:null===(n=c.meshes)||void 0===n?void 0:n.find((function(e){var t;return"mesh_mm1"===e.name&&"ambar"===(null===(t=e.material)||void 0===t?void 0:t.name)})),children:[Object(T.jsx)("standardMaterial",{name:"amber-mat",assignFrom:"material",disableLighting:e.trafficLightState.current===a.Amber}),e.trafficLightState.current===a.Amber&&Object(T.jsx)("spotLight",{name:"amber-light",direction:new O.e(0,0,Math.PI),intensity:8,angle:102,exponent:5,diffuse:x.a.FromInts(231,180,22),specular:x.a.FromInts(231,180,22),position:new O.e(0,4.55,0)})]}),Object(T.jsxs)("abstractMesh",{name:"green",fromInstance:null===(r=c.meshes)||void 0===r?void 0:r.find((function(e){return"lights_Sphere.008"===e.name})),children:[Object(T.jsx)("standardMaterial",{name:"green-mat",assignFrom:"material",disableLighting:e.trafficLightState.current===a.Green}),e.trafficLightState.current===a.Green&&Object(T.jsx)("spotLight",{name:"green-light",direction:new O.e(0,0,Math.PI),intensity:8,angle:102,exponent:5,diffuse:x.a.FromInts(45,201,55),specular:x.a.FromInts(45,201,55),position:new O.e(0,4.1,0)})]}),Object(T.jsx)("abstractMesh",{name:"walk",fromInstance:null===(i=c.meshes)||void 0===i?void 0:i.find((function(e){var t;return"mesh_mm1"===e.name&&"go"===(null===(t=e.material)||void 0===t?void 0:t.name)})),children:Object(T.jsx)("standardMaterial",{name:"walk-mat",assignFrom:"material",emissiveColor:e.pedestrianLightsToShow===v.Walk?x.a.White():x.a.Black()})}),Object(T.jsx)("abstractMesh",{name:"stop",fromInstance:null===(o=c.meshes)||void 0===o?void 0:o.find((function(e){return"humans_Cube.007"===e.name})),children:Object(T.jsx)("standardMaterial",{name:"stop-mat",assignFrom:"material",emissiveColor:e.pedestrianLightsToShow===v.Wait?x.a.White():x.a.Black()})}),Object(T.jsx)("box",{name:"traffic-base",position:new O.e(0,0,0),height:.01})]})},L=function(e){var t=Object(s.useContext)(g.c),n=0;if(null===t||void 0===t?void 0:t.lastProgress){var a=t.lastProgress;n=a.lengthComputable?a.loaded/a.total:a.loaded/1e4}return Object(T.jsxs)("transformNode",{name:"{props.name}-fallback-transform",rotation:e.rotation,position:e.center,children:[Object(T.jsx)("box",{name:"".concat(e.name,"-box-progress"),height:e.scaleTo/15,width:e.scaleTo,depth:e.scaleTo/30,scaling:new p.z(n,1,1),position:new p.z(e.scaleTo/2,0,e.scaleTo/60),setPivotMatrix:[p.k.Translation(-e.scaleTo,0,0)],setPreTransformMatrix:[p.k.Translation(-e.scaleTo/2,0,0)],children:Object(T.jsx)("standardMaterial",{name:"".concat(e.name,"-progress-mat"),diffuseColor:e.progressBarColor,specularColor:p.e.Black()})},"progress"),Object(T.jsx)("box",{name:"".concat(e.name,"-box-back"),height:e.scaleTo/15,width:e.scaleTo,depth:e.scaleTo/30,position:new p.z(0,0,e.scaleTo/-60)},"back")]})},M=n(432);function W(e,t,n,a){var r=Object(s.useState)((function(){var n=new M.a(e,t,a);return{machina:n,state:n.state,eventData:null}})),i=Object(f.a)(r,2),o=i[0],c=i[1];return Object(s.useEffect)((function(){var e=void 0===n?M.b.All:n.notificationType,t=void 0===n?void 0:n.valueFilter,a=o.machina.subscribe((function(e){c({machina:o.machina,state:o.machina.state,eventData:e})}),e,t);return console.log("starting machina:",o.machina.name),o.machina.start(),function(){o.machina.unsubscribe(a)}}),[]),[null===o||void 0===o?void 0:o.machina,o.state,o.eventData]}var y=function(){var e,t=Object(s.useState)(v.Wait),n=Object(f.a)(t,2),c=n[0],l=n[1],u=W(i.Stop,new Map([[i.Wait,{outEdges:[{on:o.ToStop,description:"Stop Walking",nextState:i.Stop}],onEnter:function(){var e=Object(j.a)(b.a.mark((function e(t,n){var a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=800,l(v.Wait),setTimeout((function(){l(v.None),setTimeout((function(){l(v.Wait),setTimeout((function(){l(v.None),setTimeout((function(){l(v.Wait)}),a)}),a)}),a)}),a),setTimeout((function(){n.transition(o.ToStop)}),4e3);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}],[i.Stop,{outEdges:[{on:o.AllowWalking,description:"start walking",nextState:i.Walk}],onEnter:function(){var e=Object(j.a)(b.a.mark((function e(t,n){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l(v.Wait),null!==n.parent&&!0!==!n.parent.isStarted){e.next=5;break}console.log("not linked as nested machine yet (or not started ".concat(null===n.parent?null:n.parent.isStarted,"'")),e.next=7;break;case 5:return e.next=7,n.parent.transition(r.TurnGreen);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}],[i.Walk,{outEdges:[{on:o.ToWaiting,description:"stop walking",nextState:i.Wait}],onEnter:function(){var e=Object(j.a)(b.a.mark((function e(t,n){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l(v.Walk),setTimeout((function(){n.transition(o.ToWaiting)}),3500);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]]),void 0,"pedestrian-machina"),d=Object(f.a)(u,2),h=d[0],m=d[1],x=W(a.Green,new Map([[a.Green,{outEdges:[{on:r.TurnAmber,description:"turn amber",nextState:a.Amber}],onEnter:function(){var e=Object(j.a)(b.a.mark((function e(t,n){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:setTimeout((function(){return n.transition(r.TurnAmber)}),2500);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}],[a.Amber,{outEdges:[{on:r.TurnRed,description:"turn red",nextState:a.Red}],onEnter:function(){var e=Object(j.a)(b.a.mark((function e(t,n){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:setTimeout((function(){return n.transition(r.TurnRed)}),700);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}],[a.Red,{outEdges:[{on:r.TurnGreen,description:"turn green",nextState:a.Green}],nestedMachinas:[h],onEnter:function(){var e=Object(j.a)(b.a.mark((function e(t,n){var a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.state.nestedMachinas,l(v.None),e.next=4,a[0].transition(o.AllowWalking);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]]),void 0,"light-machina"),O=Object(f.a)(x,3),k=(O[0],O[1]),M=O[2];return Object(s.useEffect)((function(){console.log("Traffic light switched to:",k.current)}),[k.current]),Object(T.jsxs)("div",{children:[Object(T.jsxs)("p",{style:{padding:6},children:[Object(T.jsxs)("h3",{children:[Object(T.jsx)("strong",{children:"xmachina + babylonjs"})," (Automated)"]}),Object(T.jsxs)("div",{children:["Light Currently: ",Object(T.jsx)("span",{style:{backgroundColor:w.get(k.current)},children:Object(T.jsx)("strong",{children:k.current})})]}),Object(T.jsxs)("div",{children:["Pedestrian Currently: ",m.current]}),null!==M&&Object(T.jsxs)("div",{children:["Last Traffic Light (sem\xe1foro) Event ",Object(T.jsx)("strong",{children:M.event})," from ",Object(T.jsx)("strong",{children:null!==(e=M.value.old)&&void 0!==e?e:"n/a"})," to: ",Object(T.jsx)("strong",{children:M.value.new}),"."]})]}),Object(T.jsx)(g.a,{antialias:!0,adaptToDeviceRatio:!0,canvasId:"babylonJS",children:Object(T.jsxs)(g.b,{clearColor:new p.f(.2,.4,.75,1),children:[Object(T.jsx)("arcRotateCamera",{name:"arc",target:new p.z(0,1,0),alpha:7*Math.PI/8,beta:3*Math.PI/8,radius:3,minZ:.001,wheelPrecision:50,lowerRadiusLimit:.25,upperRadiusLimit:8,upperBetaLimit:Math.PI/2}),Object(T.jsx)("hemisphericLight",{name:"hemi",direction:p.z.Up(),intensity:.8}),Object(T.jsx)(g.d,{children:Object(T.jsx)(s.Suspense,{fallback:Object(T.jsx)(L,{name:"lights-fallback",progressBarColor:p.e.Red(),rotation:new p.z(0,-3*Math.PI/8,0),center:new p.z(0,.75,0),scaleTo:1}),children:Object(T.jsx)(S,{trafficLightState:k,pedestrianLightsToShow:c,showDebug:!1})})})]})})]})},R=function(e){var t;return Object(T.jsxs)("button",{onClick:function(){return e.machina.transition(e.transition.on)},style:{backgroundColor:w.get(e.transition.nextState)},children:["click here to ",null!==(t=e.transition.description)&&void 0!==t?t:e.transition.on]})},C=function(e){return Object(T.jsx)(T.Fragment,{children:e.machina.state.possibleTransitions.map((function(t){return Object(T.jsx)(R,{machina:e.machina,transition:t})}))})},I=function(){var e,t=W(a.Green,new Map([[a.Green,{outEdges:[{on:r.TurnAmber,description:"turn amber",nextState:a.Amber}]}],[a.Amber,{outEdges:[{on:r.TurnRed,description:"turn red",nextState:a.Red}]}],[a.Red,{outEdges:[{on:r.TurnGreen,description:"turn green",nextState:a.Green}]}]])),n=Object(f.a)(t,3),i=n[0],o=n[1],c=n[2];return Object(T.jsxs)("div",{children:[Object(T.jsxs)("p",{style:{padding:6},children:[Object(T.jsxs)("h3",{children:[Object(T.jsx)("strong",{children:"xmachina + babylonjs"})," (Manual)"]}),Object(T.jsxs)("div",{children:["Light Currently: ",Object(T.jsx)("span",{style:{color:w.get(o.current)},children:o.current})]}),Object(T.jsx)(C,{machina:i}),null!==c&&Object(T.jsxs)("div",{children:["Last Event ",Object(T.jsx)("strong",{children:c.event})," from ",Object(T.jsx)("strong",{children:null!==(e=c.value.old)&&void 0!==e?e:"n/a"})," to: ",Object(T.jsx)("strong",{children:c.value.new}),"."]})]}),Object(T.jsx)(g.a,{antialias:!0,adaptToDeviceRatio:!0,canvasId:"babylonJS",children:Object(T.jsxs)(g.b,{clearColor:new p.f(.2,.4,.75,1),children:[Object(T.jsx)("arcRotateCamera",{name:"arc",target:new p.z(0,1,0),alpha:7*Math.PI/8,beta:3*Math.PI/8,radius:3,minZ:.001,wheelPrecision:50,lowerRadiusLimit:.25,upperRadiusLimit:8,upperBetaLimit:Math.PI/2}),Object(T.jsx)("hemisphericLight",{name:"hemi",direction:p.z.Up(),intensity:.8}),Object(T.jsx)(g.d,{children:Object(T.jsx)(s.Suspense,{fallback:Object(T.jsx)(L,{name:"lights-fallback",progressBarColor:p.e.Red(),rotation:new p.z(0,-3*Math.PI/8,0),center:new p.z(0,.75,0),scaleTo:1}),children:Object(T.jsx)(S,{trafficLightState:o,pedestrianLightsToShow:o.current===a.Red?v.Walk:v.Wait,showDebug:!1})})})]})})]})},A=function(){return Object(T.jsx)(d.a,{children:Object(T.jsxs)("div",{style:{width:"100vw",height:"100vh",textAlign:"center"},children:[Object(T.jsxs)("nav",{children:["Choose: ",Object(T.jsx)(d.b,{to:"".concat("/xmachina-semaforo","/"),children:"Automated"})," ",Object(T.jsx)("strong",{children:"OR "}),Object(T.jsx)(d.b,{to:"".concat("/xmachina-semaforo","/manual"),children:"Manual"})," xmachina (",Object(T.jsx)("a",{href:"https://github.com/brianzinn/xmachina",children:"github.com/brianzinn/xmachina"}),")."]}),Object(T.jsxs)(h.c,{children:[Object(T.jsx)(h.a,{exact:!0,path:"".concat("/xmachina-semaforo","/"),component:y}),Object(T.jsx)(h.a,{path:"".concat("/xmachina-semaforo","/manual"),component:I})]})]})})},P=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,496)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,i=t.getLCP,o=t.getTTFB;n(e),a(e),r(e),i(e),o(e)}))};u.a.render(Object(T.jsx)(c.a.StrictMode,{children:Object(T.jsx)(A,{})}),document.getElementById("root")),P()}},[[494,1,2]]]);
//# sourceMappingURL=main.b185ec57.chunk.js.map